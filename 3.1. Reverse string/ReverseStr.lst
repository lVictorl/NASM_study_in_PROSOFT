     1                                  section .data
     2                                      ; Сегмент данных - константы и сообщения
     3 00000000 456E74657220796F75-         prompt db "Enter your string: ", 0
     3 00000009 7220737472696E673A-
     3 00000012 2000               
     4                                      prompt_len equ $ - prompt
     5 00000014 52657665727365643A-         result db "Reversed: ", 0
     5 0000001D 2000               
     6                                      result_len equ $ - result
     7 0000001F 0A                          newline db 10
     8 00000020 4572726F723A204661-         error_read db "Error: Failed to read input", 10, 0
     8 00000029 696C656420746F2072-
     8 00000032 65616420696E707574-
     8 0000003B 0A00               
     9                                      error_read_len equ $ - error_read
    10 0000003D 4572726F723A204661-         error_write db "Error: Failed to write output", 10, 0
    10 00000046 696C656420746F2077-
    10 0000004F 72697465206F757470-
    10 00000058 75740A00           
    11                                      error_write_len equ $ - error_write
    12 0000005C 4572726F723A20456D-         error_empty db "Error: Empty string is not allowed", 10, 0
    12 00000065 70747920737472696E-
    12 0000006E 67206973206E6F7420-
    12 00000077 616C6C6F7765640A00 
    13                                      error_empty_len equ $ - error_empty
    14 00000080 4572726F723A205374-         error_too_long db "Error: String too long (max 100 chars)", 10, 0
    14 00000089 72696E6720746F6F20-
    14 00000092 6C6F6E6720286D6178-
    14 0000009B 203130302063686172-
    14 000000A4 73290A00           
    15                                      error_too_long_len equ $ - error_too_long
    16                                  
    17                                  section .bss
    18                                      ; Сегмент неинициализированных данных - буферы
    19 00000000 <res 66h>                   input resb 102      ; Буфер для ввода (100 символов + \n + \0)
    20 00000066 <res 65h>                   reversed resb 101   ; Буфер для развернутой строки
    21                                  
    22                                  section .text
    23                                      global _start
    24                                  
    25                                  ; ======================== ГЛАВНАЯ ПРОГРАММА ========================
    26                                  _start:
    27                                      ; ВЫВОД ПРИГЛАШЕНИЯ К ВВОДУ
    28                                      ; syscall: write(fd, buf, count)
    29 00000000 B801000000                  mov rax, 1          ; sys_write
    30 00000005 BF01000000                  mov rdi, 1          ; stdout
    31 0000000A 48BE-                       mov rsi, prompt
    31 0000000C [0000000000000000] 
    32 00000014 BA14000000                  mov rdx, prompt_len
    33 00000019 0F05                        syscall
    34 0000001B 4885C0                      test rax, rax       ; проверка успешности записи
    35 0000001E 0F8816010000                js write_error      ; если ошибка
    36                                      
    37                                      ; ЧТЕНИЕ СТРОКИ С КЛАВИАТУРЫ
    38                                      ; syscall: read(fd, buf, count)
    39 00000024 B800000000                  mov rax, 0          ; sys_read
    40 00000029 BF00000000                  mov rdi, 0          ; stdin
    41 0000002E 48BE-                       mov rsi, input
    41 00000030 [0000000000000000] 
    42 00000038 BA65000000                  mov rdx, 101        ; максимальная длина (100 символов + \n)
    43 0000003D 0F05                        syscall
    44 0000003F 4885C0                      test rax, rax       ; проверка успешности чтения
    45 00000042 0F88D5000000                js read_error       ; если ошибка чтения
    46 00000048 0F8409010000                jz empty_error      ; если ничего не прочитано
    47                                      
    48                                      ; Сохраняем длину введенной строки
    49 0000004E 4989C4                      mov r12, rax        ; R12 = длина строки (сохраняем, т.к. rax будет изменяться)
    50                                      
    51                                      ; ПРОВЕРКА ДЛИНЫ СТРОКИ
    52 00000051 4983FC65                    cmp r12, 101        ; сравнение с максимальной длиной
    53 00000055 0F8D19010000                jge too_long_error  ; если строка слишком длинная
    54                                      
    55                                      ; ПРОВЕРКА НА ПУСТУЮ СТРОКУ (только \n)
    56 0000005B 4983FC01                    cmp r12, 1
    57 0000005F 750E                        jne .not_empty
    58 00000061 803C25[00000000]0A          cmp byte [input], 10 ; проверка на символ новой строки
    59 00000069 0F84E8000000                je empty_error
    60                                  .not_empty:
    61                                      
    62                                      ; УДАЛЕНИЕ СИМВОЛА НОВОЙ СТРОКИ
    63 0000006F 48BF-                       mov rdi, input      ; RDI = указатель на строку
    63 00000071 [0000000000000000] 
    64 00000079 E81D010000                  call remove_newline ; вызов функции удаления новой строки
    65                                      
    66                                      ; ПРОВЕРКА НА ПУСТУЮ СТРОКУ ПОСЛЕ УДАЛЕНИЯ \n
    67 0000007E 48BF-                       mov rdi, input      ; Убедимся, что RDI содержит input
    67 00000080 [0000000000000000] 
    68 00000088 E874010000                  call check_empty_string
    69 0000008D 4885C0                      test rax, rax
    70 00000090 0F85C1000000                jnz empty_error
    71                                      
    72                                      ; РАЗВОРОТ СТРОКИ
    73 00000096 48BF-                       mov rdi, input      ; RDI = исходная строка
    73 00000098 [0000000000000000] 
    74 000000A0 48BE-                       mov rsi, reversed   ; RSI = буфер для результата
    74 000000A2 [6600000000000000] 
    75 000000AA E804010000                  call reverse_string ; вызов функции разворота
    76                                      ; Теперь в RAX указатель на начало развернутой строки
    77                                      
    78                                      ; Сохраняем указатель на развернутую строку
    79 000000AF 4989C5                      mov r13, rax        ; R13 = указатель на развернутую строку
    80                                      
    81                                      ; ВЫВОД СООБЩЕНИЯ "Reversed: "
    82 000000B2 B801000000                  mov rax, 1          ; sys_write
    83 000000B7 BF01000000                  mov rdi, 1          ; stdout
    84 000000BC 48BE-                       mov rsi, result
    84 000000BE [1400000000000000] 
    85 000000C6 BA0B000000                  mov rdx, result_len
    86 000000CB 0F05                        syscall
    87 000000CD 4885C0                      test rax, rax       ; проверка успешности записи
    88 000000D0 7868                        js write_error      ; если ошибка
    89                                      
    90                                      ; ВЫВОД РАЗВЕРНУТОЙ СТРОКИ
    91                                      ; Сначала вычислим длину развернутой строки
    92 000000D2 4C89EF                      mov rdi, r13        ; RDI = указатель на развернутую строку
    93 000000D5 E84E010000                  call get_string_length ; RAX = длина строки
    94 000000DA 4889C2                      mov rdx, rax        ; RDX = длина для write
    95                                      
    96                                      ; Теперь выводим
    97 000000DD B801000000                  mov rax, 1          ; sys_write
    98 000000E2 BF01000000                  mov rdi, 1          ; stdout
    99 000000E7 4C89EE                      mov rsi, r13        ; RSI = указатель на развернутую строку
   100 000000EA 0F05                        syscall
   101 000000EC 4885C0                      test rax, rax       ; проверка успешности записи
   102 000000EF 7849                        js write_error      ; если ошибка
   103                                      
   104                                      ; ВЫВОД СИМВОЛА НОВОЙ СТРОКИ
   105 000000F1 B801000000                  mov rax, 1
   106 000000F6 BF01000000                  mov rdi, 1
   107 000000FB 48BE-                       mov rsi, newline
   107 000000FD [1F00000000000000] 
   108 00000105 BA01000000                  mov rdx, 1
   109 0000010A 0F05                        syscall
   110 0000010C 4885C0                      test rax, rax       ; проверка успешности записи
   111 0000010F 7829                        js write_error      ; если ошибка
   112                                      
   113                                      ; УСПЕШНОЕ ЗАВЕРШЕНИЕ ПРОГРАММЫ
   114                                      ; syscall: exit(status)
   115 00000111 B83C000000                  mov rax, 60         ; sys_exit
   116 00000116 BF00000000                  mov rdi, 0          ; код возврата 0
   117 0000011B 0F05                        syscall
   118                                  
   119                                  ; ======================== ОБРАБОТЧИКИ ОШИБОК ========================
   120                                  read_error:
   121                                      ; ОШИБКА ЧТЕНИЯ
   122 0000011D B801000000                  mov rax, 1
   123 00000122 BF01000000                  mov rdi, 1
   124 00000127 48BE-                       mov rsi, error_read
   124 00000129 [2000000000000000] 
   125 00000131 BA1D000000                  mov rdx, error_read_len
   126 00000136 0F05                        syscall
   127 00000138 EB55                        jmp error_exit
   128                                  
   129                                  write_error:
   130                                      ; ОШИБКА ЗАПИСИ
   131 0000013A B801000000                  mov rax, 1
   132 0000013F BF01000000                  mov rdi, 1
   133 00000144 48BE-                       mov rsi, error_write
   133 00000146 [3D00000000000000] 
   134 0000014E BA1F000000                  mov rdx, error_write_len
   135 00000153 0F05                        syscall
   136 00000155 EB38                        jmp error_exit
   137                                  
   138                                  empty_error:
   139                                      ; ОШИБКА: ПУСТАЯ СТРОКА
   140 00000157 B801000000                  mov rax, 1
   141 0000015C BF01000000                  mov rdi, 1
   142 00000161 48BE-                       mov rsi, error_empty
   142 00000163 [5C00000000000000] 
   143 0000016B BA24000000                  mov rdx, error_empty_len
   144 00000170 0F05                        syscall
   145 00000172 EB1B                        jmp error_exit
   146                                  
   147                                  too_long_error:
   148                                      ; ОШИБКА: СЛИШКОМ ДЛИННАЯ СТРОКА
   149 00000174 B801000000                  mov rax, 1
   150 00000179 BF01000000                  mov rdi, 1
   151 0000017E 48BE-                       mov rsi, error_too_long
   151 00000180 [8000000000000000] 
   152 00000188 BA28000000                  mov rdx, error_too_long_len
   153 0000018D 0F05                        syscall
   154                                  
   155                                  error_exit:
   156                                      ; ЗАВЕРШЕНИЕ ПРОГРАММЫ С ОШИБКОЙ
   157 0000018F B83C000000                  mov rax, 60         ; sys_exit
   158 00000194 BF01000000                  mov rdi, 1          ; код возврата 1 (ошибка)
   159 00000199 0F05                        syscall
   160                                  
   161                                  ; ======================== ФУНКЦИИ ========================
   162                                  
   163                                  ; ФУНКЦИЯ: remove_newline
   164                                  ; Назначение: Удаляет символ новой строки из конца строки
   165                                  ; Вход: RDI - указатель на строку
   166                                  ; Выход: Строка без символа новой строки (нуль-терминированная)
   167                                  remove_newline:
   168 0000019B 55                          push rbp
   169 0000019C 4889E5                      mov rbp, rsp
   170                                      
   171                                  .search_newline:
   172 0000019F 803F00                      cmp byte [rdi], 0   ; Конец строки?
   173 000001A2 740D                        je .nl_done
   174 000001A4 803F0A                      cmp byte [rdi], 10  ; Символ новой строки?
   175 000001A7 7405                        je .found_newline
   176 000001A9 48FFC7                      inc rdi
   177 000001AC EBF1                        jmp .search_newline
   178                                  
   179                                  .found_newline:
   180 000001AE C60700                      mov byte [rdi], 0   ; Заменяем символ новой строки на нуль-терминатор
   181                                  
   182                                  .nl_done:
   183 000001B1 5D                          pop rbp
   184 000001B2 C3                          ret
   185                                  
   186                                  ; ФУНКЦИЯ: reverse_string
   187                                  ; Назначение: Разворачивает строку задом наперед
   188                                  ; Вход: RDI - указатель на исходную строку (нуль-терминированная)
   189                                  ;       RSI - указатель на буфер для результата (должен быть достаточно большим)
   190                                  ; Выход: RAX - указатель на начало развернутой строки (тот же что и RSI на входе)
   191                                  reverse_string:
   192 000001B3 55                          push rbp
   193 000001B4 4889E5                      mov rbp, rsp
   194 000001B7 53                          push rbx
   195 000001B8 51                          push rcx
   196 000001B9 52                          push rdx
   197                                      
   198                                      ; Сохраняем начало буфера для результата
   199 000001BA 4889F0                      mov rax, rsi        ; RAX будет хранить начало результата
   200                                      
   201                                      ; Находим длину исходной строки
   202 000001BD 4889FB                      mov rbx, rdi        ; RBX = текущая позиция в исходной строке
   203 000001C0 B900000000                  mov rcx, 0          ; RCX = длина строки
   204                                      
   205                                  .find_length:
   206 000001C5 803B00                      cmp byte [rbx], 0
   207 000001C8 7408                        je .length_found
   208 000001CA 48FFC1                      inc rcx
   209 000001CD 48FFC3                      inc rbx
   210 000001D0 EBF3                        jmp .find_length
   211                                  
   212                                  .length_found:
   213                                      ; Проверка на пустую строку
   214 000001D2 4885C9                      test rcx, rcx
   215 000001D5 741D                        jz .empty_string
   216                                      
   217                                      ; Устанавливаем указатель на конец исходной строки
   218 000001D7 4889FB                      mov rbx, rdi
   219 000001DA 4801CB                      add rbx, rcx
   220 000001DD 48FFCB                      dec rbx             ; RBX указывает на последний символ
   221                                      
   222                                      ; Разворачиваем строку
   223                                  .reverse_loop:
   224 000001E0 4885C9                      test rcx, rcx
   225 000001E3 7414                        jz .reverse_done
   226 000001E5 8A13                        mov dl, byte [rbx]  ; Берем символ с конца
   227 000001E7 8816                        mov byte [rsi], dl  ; Записываем в начало результата
   228 000001E9 48FFCB                      dec rbx
   229 000001EC 48FFC6                      inc rsi
   230 000001EF 48FFC9                      dec rcx
   231 000001F2 EBEC                        jmp .reverse_loop
   232                                  
   233                                  .empty_string:
   234 000001F4 C60600                      mov byte [rsi], 0
   235 000001F7 EB00                        jmp .reverse_done
   236                                  
   237                                  .reverse_done:
   238 000001F9 C60600                      mov byte [rsi], 0   ; Добавляем нуль-терминатор
   239                                      
   240                                      ; RAX уже содержит начало результата
   241 000001FC 5A                          pop rdx
   242 000001FD 59                          pop rcx
   243 000001FE 5B                          pop rbx
   244 000001FF 5D                          pop rbp
   245 00000200 C3                          ret
   246                                  
   247                                  ; ФУНКЦИЯ: check_empty_string
   248                                  ; Назначение: Проверяет, является ли строка пустой (содержит только whitespace символы)
   249                                  ; Вход: RDI - указатель на строку
   250                                  ; Выход: RAX = 1 если пустая, 0 если нет
   251                                  check_empty_string:
   252 00000201 55                          push rbp
   253 00000202 4889E5                      mov rbp, rsp
   254                                      
   255 00000205 B800000000                  mov rax, 0          ; по умолчанию не пустая
   256                                  .check_loop:
   257 0000020A 8A17                        mov dl, byte [rdi]
   258 0000020C 84D2                        test dl, dl         ; конец строки?
   259 0000020E 7411                        jz .is_empty
   260 00000210 80FA20                      cmp dl, 32          ; пробел?
   261 00000213 7407                        je .next_char
   262 00000215 80FA09                      cmp dl, 9           ; табуляция?
   263 00000218 7402                        je .next_char
   264 0000021A EB0A                        jmp .not_empty      ; нашли не-whitespace символ
   265                                      
   266                                  .next_char:
   267 0000021C 48FFC7                      inc rdi
   268 0000021F EBE9                        jmp .check_loop
   269                                  
   270                                  .is_empty:
   271 00000221 B801000000                  mov rax, 1          ; строка пустая
   272                                  
   273                                  .not_empty:
   274 00000226 5D                          pop rbp
   275 00000227 C3                          ret
   276                                  
   277                                  ; ФУНКЦИЯ: get_string_length
   278                                  ; Назначение: Вычисляет длину нуль-терминированной строки
   279                                  ; Вход: RDI - указатель на строку
   280                                  ; Выход: RAX - длина строки (без учета нуль-терминатора)
   281                                  get_string_length:
   282 00000228 55                          push rbp
   283 00000229 4889E5                      mov rbp, rsp
   284 0000022C 57                          push rdi            ; Сохраняем оригинальный указатель
   285                                      
   286 0000022D B800000000                  mov rax, 0
   287                                  .count_chars:
   288 00000232 803F00                      cmp byte [rdi], 0
   289 00000235 7408                        je .count_complete
   290 00000237 48FFC0                      inc rax
   291 0000023A 48FFC7                      inc rdi
   292 0000023D EBF3                        jmp .count_chars
   293                                      
   294                                  .count_complete:
   295 0000023F 5F                          pop rdi             ; Восстанавливаем оригинальный указатель
   296 00000240 5D                          pop rbp
   297 00000241 C3                          ret
